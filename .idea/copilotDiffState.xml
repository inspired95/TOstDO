<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/main/java/pl/catchex/bootstrap/DefaultConfigCreator.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/pl/catchex/bootstrap/DefaultConfigCreator.java" />
              <option name="originalContent" value="package pl.catchex.bootstrap;&#10;&#10;import org.slf4j.Logger;&#10;import org.slf4j.LoggerFactory;&#10;&#10;import java.io.IOException;&#10;import java.io.InputStream;&#10;import java.nio.charset.StandardCharsets;&#10;import java.nio.file.Path;&#10;import java.util.Scanner;&#10;import java.util.regex.Matcher;&#10;import java.util.regex.Pattern;&#10;&#10;/**&#10; * Responsible for creating the default configuration file in the application directory.&#10; */&#10;public final class DefaultConfigCreator {&#10;&#10;    private static final Logger logger = LoggerFactory.getLogger(DefaultConfigCreator.class);&#10;    private static final String PLACEHOLDER = &quot;[path_to_todo.md_file]&quot;;&#10;&#10;    private DefaultConfigCreator() {&#10;        // utility class&#10;    }&#10;&#10;    public static void createDefaultConfig(FileSystemService fs, Path appDir) throws IOException {&#10;        Path targetConfig = DefaultPaths.getConfigPath();&#10;        if (!fs.exists(targetConfig)) {&#10;            try (InputStream in = fs.getResourceAsStream(AppDirectoryInitializer.RESOURCE_CONFIGURATION)) {&#10;                if (in == null) {&#10;                    logger.warn(&quot;Default resource '{}' not found on classpath, skipping creating {}&quot;, AppDirectoryInitializer.RESOURCE_CONFIGURATION, targetConfig);&#10;                    return;&#10;                }&#10;&#10;                String content;&#10;                try (Scanner scanner = new Scanner(in, StandardCharsets.UTF_8.name())) {&#10;                    scanner.useDelimiter(&quot;\\A&quot;);&#10;                    content = scanner.hasNext() ? scanner.next() : &quot;&quot;;&#10;                }&#10;&#10;                String newTodoPath = appDir.resolve(AppDirectoryInitializer.TODO_FILENAME).toString();&#10;                String modified = applyTodoPathReplacement(content, newTodoPath);&#10;&#10;                logger.debug(&quot;DefaultConfigCreator: modified config content:\n{}&quot;, modified);&#10;&#10;                fs.writeString(targetConfig, modified, StandardCharsets.UTF_8);&#10;                logger.info(&quot;Default configuration copied to {} (with updated todoFilePath)&quot;, targetConfig);&#10;            }&#10;        } else {&#10;            logger.debug(&quot;Configuration file already exists: {}&quot;, targetConfig);&#10;        }&#10;    }&#10;&#10;    private static String applyTodoPathReplacement(String content, String newTodoPath) {&#10;        if (content.contains(PLACEHOLDER)) {&#10;           return &quot;'&quot; + escapeSingleQuotes(newTodoPath) + &quot;'&quot;;&#10;        }&#10;        throw new RuntimeException(&quot;Could not find placeholder '&quot; + PLACEHOLDER + &quot;' in default configuration content.&quot;);&#10;    }&#10;&#10;    private static String escapeSingleQuotes(String s) {&#10;        return s.replace(&quot;'&quot;, &quot;\\'&quot;);&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package pl.catchex.bootstrap;&#10;&#10;import org.slf4j.Logger;&#10;import org.slf4j.LoggerFactory;&#10;&#10;import java.io.IOException;&#10;import java.io.InputStream;&#10;import java.nio.charset.StandardCharsets;&#10;import java.nio.file.Path;&#10;import java.util.Scanner;&#10;&#10;/**&#10; * Responsible for creating the default configuration file in the application directory.&#10; */&#10;public final class DefaultConfigCreator {&#10;&#10;    private static final Logger logger = LoggerFactory.getLogger(DefaultConfigCreator.class);&#10;    private static final String PLACEHOLDER = &quot;[path_to_todo.md_file]&quot;;&#10;&#10;    private DefaultConfigCreator() {&#10;        // utility class&#10;    }&#10;&#10;    public static void createDefaultConfig(FileSystemService fs, Path appDir) throws IOException {&#10;        Path targetConfig = DefaultPaths.getConfigPath();&#10;        if (!fs.exists(targetConfig)) {&#10;            try (InputStream in = fs.getResourceAsStream(AppDirectoryInitializer.RESOURCE_CONFIGURATION)) {&#10;                if (in == null) {&#10;                    logger.warn(&quot;Default resource '{}' not found on classpath, skipping creating {}&quot;, AppDirectoryInitializer.RESOURCE_CONFIGURATION, targetConfig);&#10;                    return;&#10;                }&#10;&#10;                String content;&#10;                try (Scanner scanner = new Scanner(in, StandardCharsets.UTF_8.name())) {&#10;                    scanner.useDelimiter(&quot;\\A&quot;);&#10;                    content = scanner.hasNext() ? scanner.next() : &quot;&quot;;&#10;                }&#10;&#10;                String newTodoPath = appDir.resolve(AppDirectoryInitializer.TODO_FILENAME).toString();&#10;                String modified = applyTodoPathReplacement(content, newTodoPath);&#10;&#10;                logger.debug(&quot;DefaultConfigCreator: modified config content:\n{}&quot;, modified);&#10;&#10;                fs.writeString(targetConfig, modified, StandardCharsets.UTF_8);&#10;                logger.info(&quot;Default configuration copied to {} (with updated todoFilePath)&quot;, targetConfig);&#10;            }&#10;        } else {&#10;            logger.debug(&quot;Configuration file already exists: {}&quot;, targetConfig);&#10;        }&#10;    }&#10;&#10;    private static String applyTodoPathReplacement(String content, String newTodoPath) {&#10;        if (content == null) {&#10;            throw new IllegalStateException(&quot;Default configuration content is null&quot;);&#10;        }&#10;        if (!content.contains(PLACEHOLDER)) {&#10;            throw new IllegalArgumentException(&quot;Could not find placeholder '&quot; + PLACEHOLDER + &quot;' in default configuration content.&quot;);&#10;        }&#10;&#10;        // Replace all occurrences of the placeholder with a single-quoted, escaped path&#10;        String replacement = &quot;'&quot; + escapeSingleQuotes(newTodoPath) + &quot;'&quot;;&#10;        return content.replace(PLACEHOLDER, replacement);&#10;    }&#10;&#10;    private static String escapeSingleQuotes(String s) {&#10;        return s.replace(&quot;'&quot;, &quot;\\'&quot;);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>